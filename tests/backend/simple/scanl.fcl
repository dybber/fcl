sig runtestBlock : [int] -> Program <block> [int]<block>
fun runtestBlock arr =
  splitUp 32 arr
   |> mapPull (scanl addi 0)
   |> mapPull (return <thread>)
   |> concat 33

sig runtest : int -> int -> Program <grid> [int]<grid>
fun runtest insize outsize =
  generatePull 1 (fn i => iota insize)
   |> mapPull runtestBlock
   |> concat outsize

sig main : Program <grid> [int]
fun main =
  let insize = 32*32 in
  let outsize = 33*32 in
   do { a <- runtest insize outsize
      ; forceAndPrint outsize a
      }
